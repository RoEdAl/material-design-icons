#
# material-design-icons resource-only DLL
#

# list of icons
SET(PNGS
	action/aspect_ratio
	action/info
	action/preview
	action/today
	av/album
	av/audio_file
	av/library_music
	content/add
	content/clear
	content/content_copy
	content/link
	content/link_off
	content/select_all
	content/remove
	editor/attach_file
	editor/data_array
	file/folder
	file/folder_open
	image/audiotrack
	image/image
	image/picture_as_pdf
	navigation/arrow_downward
	navigation/more_horiz
	navigation/south
)

# generate RC file
SET(RESOURCE_FILE ${CMAKE_CURRENT_BINARY_DIR}/material-design-icons.rc)
FILE(WRITE ${RESOURCE_FILE} [=[
/*
 * This file is automatically generated by CMake
 * Please DO NOT EDIT
 */

#include <windows.h>
LANGUAGE LANG_NEUTRAL, SUBLANG_DEFAULT

// PNG+SVG
]=])

UNSET(PNG_FILES)
UNSET(SVG_FILES)
FOREACH(PNG IN LISTS PNGS)
	STRING(FIND ${PNG} "/" SLASH_POS)
	IF(${SLASH_POS} LESS_EQUAL 1)
		MESSAGE(FATAL_ERROR "Wrong PNG name: ${PNG}")
		CONTINUE()
	ENDIF()

	STRING(SUBSTRING ${PNG} 0 ${SLASH_POS} PNG_DIR)
	MATH(EXPR SLASH_POS1 "${SLASH_POS}+1")
	STRING(SUBSTRING ${PNG} ${SLASH_POS1} -1 PNG_NAME)
	MESSAGE(STATUS "PNG: ${PNG_DIR}-${PNG_NAME}")

	LIST(APPEND SVG_FILES png/${PNG_DIR}/${PNG_NAME}/${PNG_NAME}-24.svg)
	SET(SVG_RES "${PNG_DIR}-${PNG_NAME}-24 SVG \"${CMAKE_CURRENT_SOURCE_DIR}/png/${PNG_DIR}/${PNG_NAME}/${PNG_NAME}-24.svg\"")
	FILE(APPEND ${RESOURCE_FILE} "${SVG_RES}\n")

	FOREACH(SZ 18 24 36 48 64 96 128 256)
		LIST(APPEND PNG_FILES png/${PNG_DIR}/${PNG_NAME}/${PNG_NAME}-${SZ}.png)
		SET(PNG_RES "${PNG_DIR}-${PNG_NAME}-${SZ} PNG \"${CMAKE_CURRENT_SOURCE_DIR}/png/${PNG_DIR}/${PNG_NAME}/${PNG_NAME}-${SZ}.png\"")
		FILE(APPEND ${RESOURCE_FILE} "${PNG_RES}\n")
	ENDFOREACH()
ENDFOREACH()

SET(SRC_FILES ${RESOURCE_FILE})
IF(MINGW)
	# Generate empty C file
	SET(FAKE_C_FILE ${CMAKE_CURRENT_BINARY_DIR}/material-design-icons.c)
	FILE(WRITE ${FAKE_C_FILE} [=[
/*
 * This file is automatically generated by CMake
 * Please DO NOT EDIT
 */
]=])
	LIST(APPEND SRC_FILES ${FAKE_C_FILE})
ENDIF()

# now add library
ADD_LIBRARY(material-design-icons SHARED ${SRC_FILES} ${PNG_FILES} ${SVG_FILES})
SET_SOURCE_FILES_PROPERTIES(${PNG_FILES} ${SVG_FILES} PROPERTIES HEADER_FILE_ONLY ON)
SOURCE_GROUP("PNG files" FILES ${PNG_FILES})
SOURCE_GROUP("SVG files" FILES ${SVG_FILES})
SOURCE_GROUP("Generated files" FILES ${SRC_FILES})

IF(MSVC)
	TARGET_LINK_OPTIONS(material-design-icons PRIVATE "/NOENTRY" "/MANIFEST:NO")
	SET_PROPERTY(TARGET material-design-icons PROPERTY DEBUG_POSTFIX "")
ENDIF()

IF(MINGW)
	TARGET_LINK_OPTIONS(material-design-icons PRIVATE
		-nostartfiles
		-nodefaultlibs
		-nolibc
		-nostdlib
		-s
	)
	SET_PROPERTY(TARGET material-design-icons PROPERTY PREFIX "")
	SET_PROPERTY(TARGET material-design-icons PROPERTY IMPORT_PREFIX "")
ENDIF()
